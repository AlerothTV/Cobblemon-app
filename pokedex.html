<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.cdnfonts.com/css/minecraft-ia" rel="stylesheet">
    <title>Cobblemon Pokédex</title>
    <style>
        :root { 
            --font-poke: 'Minecraft', 'Courier New', monospace;
            --sb-track-color: #3a96b6;
            --sb-thumb-color: #2e7891;
            --accent-color: #7ee7e5;
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden; background: #333; 
            font-family: var(--font-poke); letter-spacing: 1px;
            display: flex; justify-content: center; align-items: center;
        }

        .pokedex-container { 
            display: flex; flex-direction: column; height: calc(100vh - 40px); 
            width: calc(100vw - 40px); max-width: 1600px; image-rendering: pixelated; 
        }

        /* Structure Jaune (Réutilisation de tes styles originaux) */
        .row-top { display: flex; height: 74px; flex-shrink: 0; }  
        .top-1 { width: 101px; background: url("img/pokedex/jaune/jaune_03.png") no-repeat; }
        .top-2, .top-8 { flex-grow: 1; background: url("img/pokedex/jaune/jaune_05.png") repeat-x; }
        .top-3 { width: 48px; background: url("img/pokedex/jaune/jaune_06.png") no-repeat; }
        .top-4, .top-6 { flex-grow: 1; background: url("img/pokedex/jaune/jaune_07.png") repeat-x; }
        .top-5 { width: 24px; background: url("img/pokedex/jaune/jaune_09.png") no-repeat; }
        .top-7 { width: 48px; background: url("img/pokedex/jaune/jaune_11.png") no-repeat; }
        .top-9 { width: 101px; background: url("img/pokedex/jaune/jaune_13.png") no-repeat; }
        
        .row-middle { display: flex; flex-grow: 1; overflow: hidden; }
        .side-column { display: flex; flex-direction: column; width: 101px; flex-shrink: 0; }
        .side-repeat { flex-grow: 1; background-repeat: repeat-y; }
        .g-mid { background-image: url("img/pokedex/jaune/jaune_22.png"); }
        .d-mid { background-image: url("img/pokedex/jaune/jaune_23.png"); }

        .screen { 
            flex-grow: 1; background-color: #3a96b6; overflow-y: auto; padding: 20px; 
            border: 3px solid var(--accent-color); outline: 10px solid #3a96b6; margin-top: 10px;
        }

        /* Filtres */
        .filter-bar { 
            background: rgba(0,0,0,0.3); padding: 15px; margin-bottom: 20px; 
            display: flex; flex-wrap: wrap; gap: 10px; border-radius: 4px; color: white;
        }
        .filter-bar select, .filter-bar input, .filter-bar button {
            background: var(--accent-color); border: 2px solid #2e7891; padding: 8px; 
            font-family: var(--font-poke); cursor: pointer;
        }

        /* Grille Pokémon */
        .pokedex-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .slot { display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; }
        .slot-background { background: #70dfe8; border: 4px solid #84feff; padding: 15px; width: 120px; text-align: center; box-shadow: 4px 4px 0px rgba(0,0,0,0.2); }
        .slot img { width: 100px; height: 100px; object-fit: contain; }
        .slot-name { margin-top: 10px; color: white; text-shadow: 2px 2px 0px #000; text-transform: uppercase; font-size: 12px; }

        /* Capture */
        .catch-trigger { position: absolute; top: -5px; right: 5px; width: 32px; height: 32px; background: url("img/pokedex/caught_seen_icon.png") no-repeat; background-size: 32px auto; z-index: 5; }
        .is-caught .catch-trigger { background-position: 0 -32px; }
        .is-caught .slot-background { background: #c18e27; border-color: #fae05d; }

        /* Modal (Détails) */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: #3a96b6; border: 5px solid var(--accent-color); padding: 30px; width: 80%; max-width: 800px; color: white; display: flex; gap: 20px; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px; }
        .stat-bar-bg { background: #2e7891; height: 10px; width: 100%; margin: 5px 0; }
        .stat-bar-fill { background: #ffd700; height: 100%; }
        .drop-icon { width: 32px; height: 32px; vertical-align: middle; margin-right: 5px; }

        /* Scrollbar */
        .screen::-webkit-scrollbar { width: 10px; }
        .screen::-webkit-scrollbar-thumb { background: var(--sb-thumb-color); border: 2px solid var(--accent-color); }
    </style>
</head>
<body>

<div class="pokedex-container">
    <div class="row-top"><div class="top-1"></div><div class="top-2"></div><div class="top-3"></div><div class="top-4"></div><div class="top-5"></div><div class="top-6"></div><div class="top-7"></div><div class="top-8"></div><div class="top-9"></div></div>
    <div class="row-middle">
        <div class="side-column"><div class="side-repeat g-mid"></div></div>
        <div class="screen">
            <div class="filter-bar" id="filters"></div>
            <div class="pokedex-grid" id="grid"></div>
        </div>
        <div class="side-column"><div class="side-repeat d-mid"></div></div>
    </div>
</div>

<div id="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<script>
    let pokedex = [];
    let translations = {};
    let currentLang = localStorage.getItem('lang') || 'fr';
    let caught = JSON.parse(localStorage.getItem('caught') || "[]");

    async function init() {
        try {
            // Note : Vérifie bien que le nom du fichier est translations_data.json sur ton GitHub
            const [dataRes, transRes] = await Promise.all([
                fetch('Data/pokedex_data.json'),
                fetch('Data/translations_data.json') 
            ]);
            pokedex = await dataRes.json();
            translations = await transRes.json();
            
            buildFilters();
            render();
        } catch (e) {
            console.error("Erreur de chargement : ", e);
            alert("Erreur de chargement des fichiers JSON. Vérifie les noms des fichiers dans le dossier Data.");
        }
    }

    // Fonction de traduction améliorée
    function t(cat, key) {
        if (!key) return "";
        const k = key.toLowerCase();
        try {
            // On cherche la traduction, sinon on renvoie la clé avec une majuscule
            return translations[currentLang][cat][k] || key.charAt(0).toUpperCase() + key.slice(1);
        } catch { 
            return key; 
        }
    }

    function buildFilters() {
        const f = document.getElementById('filters');
        // Traduction dynamique des labels de l'UI
        const searchLabel = t('ui', 'search') || "Rechercher";
        const capturedLabel = t('ui', 'captured') || "Capturés";

        f.innerHTML = `
            <input type="text" id="searchInput" placeholder="${searchLabel}..." oninput="render(this.value)">
            <select onchange="currentLang=this.value; localStorage.setItem('lang',this.value); buildFilters(); render();">
                <option value="fr" ${currentLang==='fr'?'selected':''}>Français</option>
                <option value="en" ${currentLang==='en'?'selected':''}>English</option>
            </select>
            <span style="margin-left:auto" id="counter">${caught.length} / ${pokedex.length} ${capturedLabel}</span>
        `;
    }

    function render(query = "") {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        const q = query.toLowerCase();
        
        pokedex.forEach(p => {
            const name = t('pokemon', p.name);
            const idStr = String(p.id);

            // Recherche par nom ou par numéro d'ID
            if(q && !name.toLowerCase().includes(q) && !idStr.includes(q)) return;

            const isC = caught.includes(p.id);
            const card = document.createElement('div');
            card.className = `slot ${isC ? 'is-caught' : ''}`;
            
            // On sépare le clic sur la Pokéball du clic sur la carte
            card.innerHTML = `
                <div class="catch-trigger" onclick="event.stopPropagation(); toggleCatch(${p.id})"></div>
                <div class="slot-background" onclick="showDetails(${JSON.stringify(p).replace(/"/g, '&quot;')})">
                    <img src="img/pokemon/${p.id}.webp" onerror="this.src='img/pokemon/0.webp'">
                    <div style="font-size:18px">#${p.id}</div>
                </div>
                <div class="slot-name">${name}</div>
            `;
            grid.appendChild(card);
        });
    }

    function toggleCatch(id) {
        if(caught.includes(id)) caught = caught.filter(i => i !== id);
        else caught.push(id);
        localStorage.setItem('caught', JSON.stringify(caught));
        render(document.getElementById('searchInput')?.value);
        buildFilters();
    }

    function showDetails(p) {
        const modal = document.getElementById('modal');
        const body = document.getElementById('modal-body');
        
        let dropsHtml = p.drops.map(d => `
            <div style="margin: 5px 0; display: flex; align-items: center;">
                <img class="drop-icon" src="img/item/${d.namespace}/${d.item}.png" onerror="this.src='img/item/cobblemon/question_mark.png'">
                <span>${t('items', d.item)} (x${d.range}) - <span style="color:#7ee7e5">${d.chance}%</span></span>
            </div>
        `).join('');

        body.innerHTML = `
            <span class="close-modal" onclick="document.getElementById('modal').style.display='none'">×</span>
            <div style="flex:1; text-align:center">
                <img src="img/pokemon/${p.id}.webp" style="width:200px" onerror="this.src='img/pokemon/0.webp'">
                <h2 style="text-transform: uppercase;">${t('pokemon', p.name)}</h2>
                <p style="font-size: 14px; color: #eee; line-height: 1.4;">${t('descriptions', p.name) || ""}</p>
            </div>
            <div style="flex:1">
                <h3 style="border-bottom: 2px solid #7ee7e5;">${t('ui', 'stats').toUpperCase()}</h3>
                ${Object.entries(p.baseStats).map(([s, v]) => `
                    <div style="display:flex; justify-content:space-between; font-size:12px">
                        <span>${t('ui', s).toUpperCase()}</span>
                        <span>${v}</span>
                    </div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${Math.min((v/200)*100, 100)}%"></div></div>
                `).join('')}
                
                <h3 style="margin-top:20px; border-bottom: 2px solid #7ee7e5;">DROPS</h3>
                <div style="font-size: 13px;">${dropsHtml || "Aucun drop"}</div>
            </div>
        `;
        modal.style.display = 'flex';
    }

    // Fermer le modal en cliquant à côté
    window.onclick = function(event) {
        const modal = document.getElementById('modal');
        if (event.target == modal) modal.style.display = "none";
    }

    init();
</script>
</body>
</html>
